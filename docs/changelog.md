# localtags 更新记录

## 2021-10-28 (impove: 文件完整性校验)

改进了关于文件完整性校验的逻辑及修复了相关 bug:

- 修复了文件检验日期无法更新的 bug。
- 默认校验周期从 30 天改为 90 天，每次校验量也从 3GB 减少至 1GB, 因为校验过程真的很慢。
- 对于主仓库，取消了"上次校验时间", 改成显示还有多少个文件等待校验。
- 不再自动检验备份仓库，新增 "check more" 按钮，点击该按钮的效果相当于对备份仓库进行一次限量抽检校验。（为了减少工作量，目前只能对备份仓库进行抽检，无法全检。一般来说，这足以发现由硬盘故障引起的文件损坏了。）

## 2021-06-08 (improve: 分批校验)

改进了自动校验的逻辑，现在会分批校验，避免校验耗时太长。每次校验文件体积累计达到上限时 (默认 3GB) 就停止，等下次触发校验时再处理余下的未校验文件。

### 触发校验的时机

- 主仓库：每次上传文件时
- 备份仓库：每次获取备份仓库信息时

## 2021-06-06 (fix: 备份 bug)

- 修复前：备份时检查文件创建时间，导致有些文件无法备份
- 修复后：备份时检查文件的 hash, 可正确备份文件

## 2021-05-25 (add: 标签预览)

详见 [Wiki: Tag Preview](https://github.com/ahui2016/localtags/wiki/Tag-Preview-(update:-2021-05-25))

## 2021-05-18 (add: 替换文件)

详见 [Wiki: 同名文件(例子三)](https://github.com/ahui2016/localtags/wiki/Same-Name-Files)

## 2021-05-14 (add: 快速创建 markdown 笔记)

有时，我想新建一个 markdown 文件，简单写几句话，然后保存到 localtags 里，那么，操作步骤如下所示。

**在添加该功能之前**：打开 waiting 文件夹 --> 按鼠标右键， 选择新建文件，点击新建 txt 文件 --> 把后缀名修改为 `.md` --> 双击打开文件，写内容，关闭文件 --> 更改一个合适的文件名。

**在添加该功能之后**：点击 Add Files 页面右上角的 new note 按钮 --> 写内容 --> 点击保存按钮即可。

可见，该功能可带来很大的方便。

### 但该功能并不完善，有一些问题需要注意

- 自动获取最开头的内容作为文件名，因此，如果 waiting 文件夹里恰好有同名文件，会被覆盖。
- 自动获取的文件名有可能包含不允许使用的特殊字符，点击 Save 按钮时会提示失败，也可能自动删除特殊字符。（例如，`:`, `/`, `\`, `|`, `"`, `?`, `>`, `<`, `*` 是不能使用的，而 `#`, `-`, `!`, `@` 则可以使用）
- 暂不提供预览功能，只适合用来写简短内容。
- 没有自动保存功能，需要手动点击 Save 按钮才能保存文件。
- 在 new note 页面点击 Save 按钮即可新建一个 markdown 文件，如果想用其它文本编辑器来编辑它，请先关闭 new note 页面（注意先按 Save 按钮保存内容），避免两边同时编辑同一个文件而产生互相覆盖的情况 (**特别要注意点击 Next 按钮时也会保存文件**)。

## 2021-05-12 (add: 通过网页修改配置)

详见 [README.md](../README.md) "端口等的设置"

## 2021-05-10 (add: 单个文件体积上限)

详见 [details.md](./docs/details.md)

## 2021-05-09 (add: 本地 markdown 图库) 

详见 [details.md](./docs/details.md)

## 2021-05-08 (fix: 备份仓库文件校验)

- bug: 每次备份时，都校验备份仓库里的全部文件
- 修复后: 每次备份时，只校验备份仓库里超过一定时间未校验的文件

### 修复步骤

（**注意：如果全新安装，则不需要进行修复操作**）

1. 获取最新版本，重新编译，重启程序
   ```
   $ cd /path/to/localtags
   $ git pull
   $ go build
   $ ./localtags.exe
   ```
2. 手动打开 config.json 文件，把里面的 `CheckInterval` 后面的数值修改为 `2592000` (该数值可自由设定, 单位是秒, 2592000 是 30 天, 如果设为 86400 则是一天，建议设为 2592000)
