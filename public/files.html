<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  <link rel="stylesheet" href="/public/bootstrap-5beta2.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/public/style-light.css">
  
  <script src="/public/jquery.min.js"></script>
  <script src="/public/dayjs.min.js"></script>
  <script src="/public/bootstrap.bundle.min.js"></script>
  <script src="/public/util.js"></script>
  <script src="/public/filelist.js"></script>
  
  <title>Files - localtags</title>
</head>
<body>
  <div id="root" class="container" style="max-width: 775px; min-width: 400px;"></div>
  <script>

const Alerts = CreateAlerts();

const [InfoBtn, InfoMsg] = CreateInfoPair('使用说明', [
  '双击文件名可修改文件名，点击标签图标可修改标签。',
  '修改文件名或标签时，如果内容不变或清空文本框后按 OK 按钮，相当于取消。',
  '删除文件相当于扔进回收站，可以去回收站找回文件，也可以去回收站彻底删除文件。',
]);

const Navbar = {
  view: () => m('nav').addClass('navbar navbar-light bg-light').append([
    m('div').addClass('container-fluid').append([
      m('a').attr({title:'main menu',href:'/light/home',type:'button'})
        .addClass('btn btn-outline-dark').append(m('i').addClass('bi bi-house-door')),
      m('span').addClass('navbar-brand').append([
        m('span').addClass('PageTitle').text('Files'), ' ', m(InfoBtn),
      ]),
      m('div').addClass('btn-group').append([
        m('a').attr({title:'Tag Groups',href:'/light/tag-groups',type:'button'}).addClass('btn btn-outline-dark').append(
          m('i').addClass('bi bi-tags')
        ),
        m('a').attr({title:'Add Files',href:'/light/add',type:'button'}).addClass('btn btn-outline-dark').append(
          m('i').addClass('bi bi-file-earmark-plus')
        ),
        m('a').attr({title:'Recycle Bin',href:'/light/files?filter=deleted',type:'button'}).addClass('RecycleBtn btn btn-outline-dark').append(
          m('i').addClass('bi bi-trash'),
        ),
        m('a').attr({title:'Files',href:'/light/files',type:'button'}).addClass('AllFilesBtn btn btn-outline-dark').hide().append(
          m('i').addClass('bi bi-card-list'),
        ),
      ]),
    ]),
  ]),
};

$('#root').append([
  m(Navbar).addClass('mt-2 mb-5'),
  m(InfoMsg).hide(),
  m(Loading),
  m(Alerts),
  m(FileList).addClass('mt-3'),
  m(BottomLine),
]);
  
init()

function init() {
  const filter = getUrlParam('filter');
  let url = '/api/all-files';
  let notFoundMsg = '没有文件，一个也没有。';
  if (filter == 'deleted') {
    url = '/api/deleted-files';
    notFoundMsg = '数据库中没有标记为 "已删除" 的文件';
    $('.PageTitle').text('Recycle Bin');
    $('title').text('Recycle Bin - localtags');
    InfoMsg.setMsg([
      '这里是回收站，在这里删除文件是彻底删除，不可恢复。'
    ]);
    $('.RecycleBtn').hide();
    $('.AllFilesBtn').show();
  }

  ajax({method:'GET',url:url,alerts:Alerts},
    (files) => {
      if (!files || files.length == 0) {
        Alerts.insert('info', notFoundMsg);
        return;
      }
      FileList.prepend(files);
    }, null, () => {
      Loading.hide();
    });
}

  </script>
</body>
</html>